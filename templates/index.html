<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rust Network Discovery Tool</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --accent-primary: #3b82f6;
      --accent-secondary: #8b5cf6;
      --accent-success: #10b981;
      --border-color: #334155;
      --shadow: rgba(0, 0, 0, 0.3);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
    }

    /* Header */
    header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 0.5rem 2rem 0 2rem;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      box-shadow: 0 2px 8px var(--shadow);
      z-index: 100;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      padding-bottom: 0.375rem;
    }

    .logo a {
      text-decoration: none;
      background: inherit;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .controls {
      display: flex;
      gap: 1.5rem;
      align-items: center;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .control-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 500;
    }

    select {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 150px;
    }

    select:hover {
      border-color: var(--accent-primary);
      background: var(--bg-secondary);
    }

    select:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* Main Layout */
    .container {
      height: calc(100vh - 42px);
      padding: 1rem 1rem 0 1rem;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Filter Bar */
    .filter-bar {
      background: rgba(30, 41, 59, 0.85);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(51, 65, 85, 0.6);
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .filter-bar .quick-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .filter-bar .filter-row {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .filter-bar .filter-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .filter-bar .filter-checkboxes {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }

    .filter-bar .filter-label {
      position: relative;
    }

    .filter-bar .filter-only-btn {
      display: none;
      padding: 0 0.2rem;
      margin-left: 0.15rem;
      font-size: 0.55rem;
      background: rgba(255, 255, 255, 0.15);
      border: none;
      border-radius: 0.2rem;
      color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      line-height: 1;
      vertical-align: middle;
    }

    .filter-bar .filter-label:hover .filter-only-btn {
      display: inline-block;
    }

    .filter-bar .filter-only-btn:hover {
      background: rgba(255, 255, 255, 0.25);
      color: #fff;
    }

    .search-bar {
      background: rgba(30, 41, 59, 0.85);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(51, 65, 85, 0.6);
      border-radius: 0.75rem;
      padding: 0.5rem 1rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .search-bar .search-input-wrapper {
      flex: 1;
      position: relative;
    }

    .search-bar .search-input {
      width: 100%;
      padding: 0.5rem 0.75rem 0.5rem 2rem;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(71, 85, 105, 0.5);
      border-radius: 0.5rem;
      color: var(--text-primary);
      font-size: 0.85rem;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .search-bar .search-input:focus {
      border-color: #8b5cf6;
      box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
    }

    .search-bar .search-input::placeholder {
      color: var(--text-secondary);
    }

    .search-bar .search-icon {
      position: absolute;
      left: 0.65rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 0.85rem;
      pointer-events: none;
    }

    .search-bar .refresh-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card {
      background: rgba(51, 65, 85, 0.5);
      border-radius: 0.75rem;
      padding: 1rem;
      border: 1px solid rgba(51, 65, 85, 0.6);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }

    .card-title {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }

    .input-group {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    input[type="text"] {
      flex: 1;
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid rgba(51, 65, 85, 0.6);
      color: var(--text-primary);
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    button {
      background: var(--accent-primary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    button:hover {
      background: #2563eb;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
    }

    button.secondary:hover {
      background: var(--bg-tertiary);
      border-color: var(--accent-primary);
      box-shadow: none;
    }

    .list-box {
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
      margin-bottom: 0.375rem;
    }

    .list-item {
      background: rgba(51, 65, 85, 0.5);
      color: var(--text-primary);
      padding: 0.375rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid rgba(51, 65, 85, 0.6);
      font-family: 'Monaco', 'Courier New', monospace;
      position: relative;
      padding-right: 4rem;
    }

    .endpoint-name {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: calc(100% - 5rem);
      display: inline-block;
    }

    .endpoint-vendor {
      position: absolute;
      right: 5rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.625rem;
      color: #60a5fa;
      background: rgba(59, 130, 246, 0.15);
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
      white-space: nowrap;
      max-width: 5rem;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .endpoint-bytes {
      position: absolute;
      right: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.625rem;
      color: var(--text-secondary);
      background: rgba(15, 23, 42, 0.5);
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
      white-space: nowrap;
    }

    .list-item:hover {
      background: var(--accent-primary);
      color: white;
      border-color: var(--accent-primary);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }

    .list-item:active {
      transform: translateY(0);
    }

    .list-item.selected {
      background: var(--accent-primary);
      color: white;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
    }

    .section {
      margin-bottom: 0.75rem;
    }

    .section:last-child {
      margin-bottom: 0;
    }

    /* Graph Container */
    #graph-container {
      flex: 1;
      display: flex;
      background: var(--bg-primary);
      min-height: 0; /* Important: allows flex item to shrink below content size */
    }

    /* Endpoints Table View */
    .endpoints-table-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0 1.5rem;
      overflow: hidden;
      box-sizing: border-box;
      min-height: 0;
    }

    .endpoints-table-wrapper {
      flex: 1;
      overflow-y: auto;
      min-height: 0;
    }

    .endpoints-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }

    .endpoints-table th {
      background: var(--bg-secondary);
      color: var(--text-primary);
      padding: 0.75rem 1rem;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid var(--border-color);
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .endpoints-table th:hover {
      background: rgba(59, 130, 246, 0.15);
    }

    .endpoints-table th .sort-icon {
      margin-left: 0.5rem;
      opacity: 0.5;
      font-size: 0.75rem;
    }

    .endpoints-table th.sorted-asc .sort-icon::after {
      content: '‚ñ≤';
      opacity: 1;
    }

    .endpoints-table th.sorted-desc .sort-icon::after {
      content: '‚ñº';
      opacity: 1;
    }

    .endpoints-table th:not(.sorted-asc):not(.sorted-desc) .sort-icon::after {
      content: '‚áÖ';
    }

    .endpoints-table td {
      padding: 0.625rem 1rem;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-primary);
      vertical-align: middle;
    }

    .endpoints-table tbody tr {
      transition: background 0.15s;
      cursor: pointer;
    }

    .endpoints-table tbody tr:hover {
      background: rgba(59, 130, 246, 0.1);
    }

    .endpoints-table tbody tr.selected {
      background: rgba(59, 130, 246, 0.2);
    }

    /* Endpoint type color coding */
    .endpoint-row[data-endpoint-type="gaming"] {
      border-left: 3px solid #ef4444;
      background: rgba(239, 68, 68, 0.08);
    }
    .endpoint-row[data-endpoint-type="tv"] {
      border-left: 3px solid #a855f7;
      background: rgba(168, 85, 247, 0.08);
    }
    .endpoint-row[data-endpoint-type="phone"] {
      border-left: 3px solid #22c55e;
      background: rgba(34, 197, 94, 0.08);
    }
    .endpoint-row[data-endpoint-type="printer"] {
      border-left: 3px solid #f59e0b;
      background: rgba(245, 158, 11, 0.08);
    }
    .endpoint-row[data-endpoint-type="gateway"] {
      border-left: 3px solid #3b82f6;
      background: rgba(59, 130, 246, 0.08);
    }
    .endpoint-row[data-endpoint-type="internet"] {
      border-left: 3px solid #6b7280;
      background: rgba(107, 114, 128, 0.05);
    }
    .endpoint-row[data-endpoint-type="local"] {
      border-left: 3px solid #06b6d4;
      background: rgba(6, 182, 212, 0.08);
    }
    .endpoint-row[data-endpoint-type="virtualization"] {
      border-left: 3px solid #8b5cf6;
      background: rgba(139, 92, 246, 0.08);
    }
    .endpoint-row[data-endpoint-type="soundbar"] {
      border-left: 3px solid #ec4899;
      background: rgba(236, 72, 153, 0.08);
    }
    .endpoint-row[data-endpoint-type="appliance"] {
      border-left: 3px solid #d97706;
      background: rgba(217, 119, 6, 0.08);
    }
    .endpoint-row[data-endpoint-type="other"] {
      border-left: 3px solid #64748b;
      background: rgba(100, 116, 139, 0.05);
    }

    /* Keep selected state visible over type colors */
    .endpoint-row.selected {
      background: rgba(59, 130, 246, 0.25) !important;
    }

    .endpoint-type-cell {
      font-size: 1.25rem;
      text-align: center;
      width: 3rem;
    }

    .endpoint-name-cell {
      font-weight: 500;
      font-family: 'Monaco', 'Courier New', monospace;
    }

    .ip-list, .mac-list {
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 0.75rem;
    }

    .ip-list span, .mac-list span {
      display: inline-block;
      background: rgba(51, 65, 85, 0.5);
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
      margin: 0.125rem;
    }

    .bandwidth-cell {
      font-family: 'Monaco', 'Courier New', monospace;
      text-align: right;
      white-space: nowrap;
    }

    .vendor-cell {
      color: var(--text-secondary);
      font-size: 0.75rem;
      max-width: 150px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .model-cell {
      color: var(--accent-secondary);
      font-size: 0.75rem;
      max-width: 150px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Zoom Controls - Hidden for table view */
    .zoom-controls {
      position: absolute;
      bottom: 2.5rem;
      right: 445px;
      display: flex;
      flex-direction: row;
      gap: 0.25rem;
      z-index: 10;
    }

    .zoom-btn {
      width: 32px;
      height: 32px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 0.375rem;
      color: var(--text-primary);
      font-size: 1.25rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .zoom-btn:hover {
      background: var(--bg-tertiary);
      border-color: var(--accent-primary);
    }

    .zoom-btn:active {
      transform: scale(0.95);
    }

    /* Stats Badge */
    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 0.375rem;
      margin-top: 0.5rem;
    }

    .stat-badge {
      background: rgba(15, 23, 42, 0.5);
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.6875rem;
      color: var(--text-secondary);
    }

    .stat-badge.stat-link {
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .stat-badge.stat-link:hover {
      background: rgba(139, 92, 246, 0.3);
      color: var(--text-primary);
    }

    .stat-number {
      color: var(--accent-primary);
      font-weight: 600;
    }

    /* Device Type Dropdown */
    .device-type-selector {
      position: relative;
      display: inline-block;
    }

    .device-type-btn {
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.4);
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
    }

    .device-type-btn:hover {
      background: rgba(59, 130, 246, 0.3);
      border-color: rgba(59, 130, 246, 0.6);
    }

    .device-type-btn .dropdown-arrow {
      font-size: 0.5rem;
      opacity: 0.7;
    }

    .device-type-btn.manual-override {
      background: rgba(139, 92, 246, 0.2);
      border-color: rgba(139, 92, 246, 0.4);
    }

    .device-type-btn.manual-override:hover {
      background: rgba(139, 92, 246, 0.3);
      border-color: rgba(139, 92, 246, 0.6);
    }

    .device-type-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 0.25rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      box-shadow: 0 4px 12px var(--shadow);
      z-index: 1000;
      min-width: 160px;
      display: none;
      overflow: hidden;
    }

    .device-type-dropdown.open {
      display: block;
    }

    .device-type-option {
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .device-type-option:hover {
      background: rgba(59, 130, 246, 0.1);
      color: var(--text-primary);
    }

    .device-type-option.selected {
      background: rgba(59, 130, 246, 0.2);
      color: var(--text-primary);
    }

    .device-type-option.auto-option {
      border-bottom: 1px solid var(--border-color);
      color: var(--accent-primary);
    }

    .pulse {
      width: 8px;
      height: 8px;
      background: var(--accent-success);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .pulse.stopped {
      background: #ef4444;
      animation: none;
      opacity: 1;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .stop-refresh-btn {
      padding: 0.25rem 0.5rem;
      background: transparent;
      border: none;
      border-radius: 0.375rem;
      cursor: pointer;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      transition: all 0.2s ease;
    }

    .stop-refresh-btn:hover {
      transform: scale(1.05);
    }

    .stop-refresh-btn:active {
      transform: scale(0.95);
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 0.375rem;
    }

    .tab-btn {
      padding: 0.375rem 0.625rem;
      background: rgba(51, 65, 85, 0.4);
      border: 1px solid var(--border-color);
      border-radius: 0.25rem 0.25rem 0 0;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-size: 0.65rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: -1px;
    }

    .tab-btn:hover {
      background: rgba(139, 92, 246, 0.2);
      border-color: rgba(139, 92, 246, 0.4);
      color: var(--text-primary);
    }

    .tab-btn.active {
      background: var(--bg-primary);
      border-color: var(--border-color);
      border-bottom-color: var(--bg-primary);
      color: var(--text-primary);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* DNS Table */
    .dns-table-container {
      padding: 1rem;
      overflow: auto;
      height: calc(100vh - 73px);
    }

    .dns-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.75rem;
    }

    .dns-table th,
    .dns-table td {
      padding: 0.5rem 0.75rem;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .dns-table th {
      background: var(--bg-secondary);
      color: var(--text-secondary);
      font-weight: 600;
      position: sticky;
      top: 0;
    }

    .dns-table tr:hover {
      background: rgba(139, 92, 246, 0.1);
    }

    .dns-table td {
      color: var(--text-primary);
      font-family: 'Monaco', 'Courier New', monospace;
    }

    /* Pagination styling */
    .pagination-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      font-size: 0.8rem;
      position: sticky;
      bottom: 0;
    }

    .pagination-info {
      color: var(--text-secondary);
    }

    .pagination-controls {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .pagination-btn {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 0.375rem 0.625rem;
      border-radius: 0.375rem;
      cursor: pointer;
      font-size: 0.75rem;
      transition: all 0.15s;
      min-width: 2rem;
      text-align: center;
    }

    .pagination-btn:hover:not(:disabled) {
      background: var(--bg-primary);
      border-color: var(--accent-primary);
    }

    .pagination-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .pagination-btn.active {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: white;
    }

    .pagination-ellipsis {
      color: var(--text-secondary);
      padding: 0 0.25rem;
    }

    .page-size-select {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      padding: 0.375rem 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      cursor: pointer;
      margin-left: 0.5rem;
    }

    .page-size-select:hover {
      border-color: var(--accent-primary);
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--bg-tertiary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--border-color);
    }

    /* Empty state */
    .empty-state {
      color: var(--text-secondary);
      font-size: 0.75rem;
      font-style: italic;
      padding: 0.375rem 0.5rem;
    }

    /* Range slider styling */
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--accent-color);
      cursor: pointer;
      border: 2px solid rgba(15, 23, 42, 0.8);
    }

    input[type="range"]::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--accent-color);
      cursor: pointer;
      border: 2px solid rgba(15, 23, 42, 0.8);
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      background: #10b981;
    }

    input[type="range"]::-moz-range-thumb:hover {
      background: #10b981;
    }

    /* Endpoint Details Panel */
    .protocols-overlay {
      width: 400px;
      flex-shrink: 0;
      height: 100%;
      background: rgba(30, 41, 59, 0.95);
      border-left: 1px solid rgba(51, 65, 85, 0.6);
      padding: 1rem;
      overflow-y: auto;
      box-sizing: border-box;
    }

    .overlay-header {
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      padding-bottom: 0.5rem;
      margin-bottom: 0.75rem;
      border-bottom: 1px solid rgba(51, 65, 85, 0.6);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .overlay-header:not(:first-child) {
      margin-top: 0.75rem;
    }

    .clear-filter-btn, .clear-port-filter-btn {
      background: var(--accent-secondary);
      color: white;
      border: none;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.625rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .clear-filter-btn:hover, .clear-port-filter-btn:hover {
      background: #7c3aed;
      transform: translateY(-1px);
    }

    .overlay-content {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .protocol-badge {
      background: rgba(51, 65, 85, 0.5);
      color: var(--text-primary);
      padding: 0.375rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid rgba(51, 65, 85, 0.6);
      white-space: nowrap;
    }

    .protocol-badge:hover {
      background: var(--accent-primary);
      color: white;
      border-color: var(--accent-primary);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }

    .protocol-badge:active {
      transform: translateY(0);
    }

    .protocol-badge.selected {
      background: var(--accent-primary);
      color: white;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
    }

    .protocol-badge.dimmed {
      opacity: 0.4;
    }

    .protocol-dropdown {
      position: fixed;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      min-width: 200px;
      max-width: 300px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }

    .protocol-dropdown.show {
      display: block;
    }

    .protocol-dropdown-header {
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-primary);
      position: sticky;
      top: 0;
    }

    .protocol-dropdown-item {
      padding: 0.5rem 0.75rem;
      font-size: 0.8125rem;
      color: var(--text-primary);
      cursor: pointer;
      transition: background 0.15s;
      border-bottom: 1px solid rgba(51, 65, 85, 0.3);
    }

    .protocol-dropdown-item:last-child {
      border-bottom: none;
    }

    .protocol-dropdown-item:hover {
      background: var(--accent-primary);
      color: white;
    }

    .protocol-dropdown-empty {
      padding: 0.75rem;
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-align: center;
      font-style: italic;
    }

    .protocol-dropdown-loading {
      padding: 0.75rem;
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-align: center;
    }

    .overlay-hostnames {
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
      margin-bottom: 0.75rem;
    }

    .listbox {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(51, 65, 85, 0.6);
      border-radius: 0.5rem;
      max-height: 150px;
      overflow-y: auto;
      margin-bottom: 0.75rem;
    }

    .listbox::-webkit-scrollbar {
      width: 6px;
    }

    .listbox::-webkit-scrollbar-track {
      background: rgba(30, 41, 59, 0.3);
      border-radius: 3px;
    }

    .listbox::-webkit-scrollbar-thumb {
      background: rgba(100, 116, 139, 0.5);
      border-radius: 3px;
    }

    .listbox::-webkit-scrollbar-thumb:hover {
      background: rgba(100, 116, 139, 0.7);
    }

    .listbox-item {
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      color: var(--text-primary);
      border-bottom: 1px solid rgba(51, 65, 85, 0.3);
      cursor: pointer;
      transition: background 0.15s;
      font-family: 'Monaco', 'Courier New', monospace;
    }

    .listbox-item:last-child {
      border-bottom: none;
    }

    .listbox-item:hover {
      background: rgba(59, 130, 246, 0.15);
    }

    .listbox-item.selected {
      background: rgba(59, 130, 246, 0.25);
    }

    .listbox .empty-state {
      padding: 1rem;
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.75rem;
    }

    .hostname-item {
      background: transparent;
      color: var(--text-primary);
      padding: 0.25rem 0 0.25rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 400;
      cursor: default;
      font-family: 'Monaco', 'Courier New', monospace;
      user-select: text;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      line-height: 1.4;
    }

    .probe-btn {
      margin-left: 0.5rem;
      padding: 0.1rem 0.4rem;
      font-size: 0.65rem;
      background: var(--accent-color);
      color: white;
      border: none;
      border-radius: 0.2rem;
      cursor: pointer;
      font-family: inherit;
    }

    .probe-btn:hover {
      background: var(--accent-hover);
    }

    .probe-btn:disabled {
      background: var(--text-secondary);
      cursor: not-allowed;
    }

    /* Detail Tabs (inside right panel) */
    .detail-tabs {
      display: flex;
      gap: 0.25rem;
    }

    .detail-tab {
      padding: 0.25rem 0.5rem;
      background: rgba(51, 65, 85, 0.4);
      border: 1px solid var(--border-color);
      border-radius: 0.25rem;
      color: var(--text-secondary);
      font-size: 0.65rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .detail-tab:hover {
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.4);
      color: var(--text-primary);
    }

    .detail-tab.active {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: white;
    }

    .detail-tab-content {
      display: none;
    }

    .detail-tab-content.active {
      display: block;
    }

    /* Remote Control Styles */
    .remote-section {
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(51, 65, 85, 0.4);
    }

    .remote-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .remote-label {
      font-size: 0.7rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .remote-dpad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 0.25rem;
      max-width: 150px;
      margin: 0 auto;
    }

    .remote-btn {
      padding: 0.5rem;
      background: rgba(51, 65, 85, 0.6);
      border: 1px solid var(--border-color);
      border-radius: 0.375rem;
      color: var(--text-primary);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 36px;
    }

    .remote-btn:hover {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      transform: translateY(-1px);
    }

    .remote-btn:active {
      transform: translateY(0);
      background: #2563eb;
    }

    .remote-btn.dpad-up {
      grid-column: 2;
      grid-row: 1;
    }

    .remote-btn.dpad-left {
      grid-column: 1;
      grid-row: 2;
    }

    .remote-btn.dpad-ok {
      grid-column: 2;
      grid-row: 2;
      background: var(--accent-primary);
      font-weight: 600;
    }

    .remote-btn.dpad-right {
      grid-column: 3;
      grid-row: 2;
    }

    .remote-btn.dpad-down {
      grid-column: 2;
      grid-row: 3;
    }

    .remote-row {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
    }

    .remote-btn.power-btn {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.4);
      color: #f87171;
      width: 100%;
    }

    .remote-btn.power-btn:hover {
      background: #ef4444;
      border-color: #ef4444;
      color: white;
    }

    .apps-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      max-height: 200px;
      overflow-y: auto;
    }

    .app-btn {
      padding: 0.5rem;
      background: rgba(51, 65, 85, 0.5);
      border: 1px solid var(--border-color);
      border-radius: 0.375rem;
      color: var(--text-primary);
      font-size: 0.65rem;
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      text-align: center;
      word-break: break-word;
    }

    .app-btn:hover {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
    }

    .app-btn img {
      width: 32px;
      height: 32px;
      border-radius: 0.25rem;
    }

    /* Hide endpoint rows until filters are applied to prevent flash of unfiltered content */
    .filters-pending .endpoint-row {
      visibility: hidden;
    }
    .filters-pending .endpoint-row.selected {
      visibility: visible;
    }
  </style>
</head>
<body class="filters-pending">
  <header>
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('network')">Network</button>
      <button class="tab-btn" onclick="switchTab('dns')">mDNS Entries</button>
      <button class="tab-btn" onclick="switchTab('scanner')">Scanner</button>
      <button class="tab-btn" onclick="switchTab('pcap')">PCAP</button>
    </div>
    <div class="logo"><a href="/">‚ö° Rust Network Discovery Tool</a></div>
  </header>

  <!-- Network Tab Content -->
  <div id="network-tab" class="tab-content active">
  <div class="container">
    <!-- Filter Bar -->
    <div class="filter-bar">
      <div class="filter-row">
        <div class="quick-buttons">
          <button onclick="selectAllFilters()" style="font-size: 0.7rem; padding: 0.25rem 0.5rem; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.4); color: #60a5fa; border-radius: 0.25rem; cursor: pointer; font-weight: 500;">All</button>
          <button onclick="selectLocalFilters()" style="font-size: 0.7rem; padding: 0.25rem 0.5rem; background: rgba(34, 197, 94, 0.2); border: 1px solid rgba(34, 197, 94, 0.4); color: #4ade80; border-radius: 0.25rem; cursor: pointer; font-weight: 500;">Local</button>
          <button onclick="selectHomeFilters()" style="font-size: 0.7rem; padding: 0.25rem 0.5rem; background: rgba(251, 146, 60, 0.2); border: 1px solid rgba(251, 146, 60, 0.4); color: #fb923c; border-radius: 0.25rem; cursor: pointer; font-weight: 500;">Home</button>
          <button onclick="selectNoneFilters()" style="font-size: 0.7rem; padding: 0.25rem 0.5rem; background: rgba(100, 116, 139, 0.2); border: 1px solid rgba(100, 116, 139, 0.4); color: #94a3b8; border-radius: 0.25rem; cursor: pointer; font-weight: 500;">None</button>
        </div>
        <select id="globalProtocolSelect" onchange="filterByGlobalProtocol(this.value)" style="padding: 0.3rem 0.4rem; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(71, 85, 105, 0.5); border-radius: 0.375rem; color: var(--text-primary); font-size: 0.7rem; cursor: pointer;">
          <option value="">All Protocols</option>
        </select>
        <select id="globalVendorSelect" onchange="filterByVendor(this.value)" style="padding: 0.3rem 0.4rem; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(71, 85, 105, 0.5); border-radius: 0.375rem; color: var(--text-primary); font-size: 0.7rem; cursor: pointer;">
          <option value="">All Vendors</option>
          {% for vendor in unique_vendors %}
          <option value="{{ vendor }}">{{ vendor }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="filter-row">
        <div class="filter-checkboxes">
          <label class="filter-label" style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.7rem; cursor: pointer; padding: 0.25rem 0.375rem; background: rgba(45, 27, 78, 0.5); border-radius: 0.375rem; border: 1px solid #8b5cf6; white-space: nowrap;">
            <input type="checkbox" id="filterLocal" checked onchange="applyFilters()" onclick="handleFilterClick(event, 'filterLocal')" style="cursor: pointer;">
            <span>üíª Local</span>
            <button class="filter-only-btn" onclick="event.preventDefault(); event.stopPropagation(); selectOnlyFilter('filterLocal')" title="Show only this type">only</button>
          </label>
          <label class="filter-label" style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.7rem; cursor: pointer; padding: 0.25rem 0.375rem; background: rgba(66, 32, 6, 0.5); border-radius: 0.375rem; border: 1px solid #f59e0b; white-space: nowrap;">
            <input type="checkbox" id="filterGateway" checked onchange="applyFilters()" onclick="handleFilterClick(event, 'filterGateway')" style="cursor: pointer;">
            <span>üåê Gateway</span>
            <button class="filter-only-btn" onclick="event.preventDefault(); event.stopPropagation(); selectOnlyFilter('filterGateway')" title="Show only this type">only</button>
          </label>
          <label class="filter-label" style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.7rem; cursor: pointer; padding: 0.25rem 0.375rem; background: rgba(8, 51, 68, 0.5); border-radius: 0.375rem; border: 1px solid #06b6d4; white-space: nowrap;">
            <input type="checkbox" id="filterInternet" onchange="applyFilters()" onclick="handleFilterClick(event, 'filterInternet')" style="cursor: pointer;">
            <span>üåç Internet</span>
            <button class="filter-only-btn" onclick="event.preventDefault(); event.stopPropagation(); selectOnlyFilter('filterInternet')" title="Show only this type">only</button>
          </label>
          <label class="filter-label" style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.7rem; cursor: pointer; padding: 0.25rem 0.375rem; background: rgba(30, 58, 40, 0.5); border-radius: 0.375rem; border: 1px solid #10b981; white-space: nowrap;">
            <input type="checkbox" id="filterPrinter" checked onchange="applyFilters()" onclick="handleFilterClick(event, 'filterPrinter')" style="cursor: pointer;">
            <span>üñ®Ô∏è Printer</span>
            <button class="filter-only-btn" onclick="event.preventDefault(); event.stopPropagation(); selectOnlyFilter('filterPrinter')" title="Show only this type">only</button>
          </label>
          <label class="filter-label" style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.7rem; cursor: pointer; padding: 0.25rem 0.375rem; background: rgba(60, 31, 95, 0.5); border-radius: 0.375rem; border: 1px solid #c084fc; white-space: nowrap;">
            <input type="checkbox" id="filterTv" checked onchange="applyFilters()" onclick="handleFilterClick(event, 'filterTv')" style="cursor: pointer;">
            <span>üì∫ TV</span>
            <button class="filter-only-btn" onclick="event.preventDefault(); event.stopPropagation(); selectOnlyFilter('filterTv')" title="Show only this type">only</button>
          </label>
          <label class="filter-label" style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.7rem; cursor: pointer; padding: 0.25rem 0.375rem; background: rgba(92, 28, 46, 0.5); border-radius: 0.375rem; border: 1px solid #f43f5e; white-space: nowrap;">
            <input type="checkbox" id="filterGaming" checked onchange="applyFilters()" onclick="handleFilterClick(event, 'filterGaming')" style="cursor: pointer;">
            <span>üéÆ Gaming</span>
            <button class="filter-only-btn" onclick="event.preventDefault(); event.stopPropagation(); selectOnlyFilter('filterGaming')" title="Show only this type">only</button>
          </label>
          <label class="filter-label" style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.7rem; cursor: pointer; padding: 0.25rem 0.375rem; background: rgba(8, 51, 51, 0.5); border-radius: 0.375rem; border: 1px solid #14b8a6; white-space: nowrap;">
            <input type="checkbox" id="filterPhone" checked onchange="applyFilters()" onclick="handleFilterClick(event, 'filterPhone')" style="cursor: pointer;">
            <span>üì± Phone</span>
            <button class="filter-only-btn" onclick="event.preventDefault(); event.stopPropagation(); selectOnlyFilter('filterPhone')" title="Show only this type">only</button>
          </label>
          <label class="filter-label" style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.7rem; cursor: pointer; padding: 0.25rem 0.375rem; background: rgba(30, 41, 59, 0.5); border-radius: 0.375rem; border: 1px solid #94a3b8; white-space: nowrap;">
            <input type="checkbox" id="filterVirtualization" checked onchange="applyFilters()" onclick="handleFilterClick(event, 'filterVirtualization')" style="cursor: pointer;">
            <span>üñ• VM</span>
            <button class="filter-only-btn" onclick="event.preventDefault(); event.stopPropagation(); selectOnlyFilter('filterVirtualization')" title="Show only this type">only</button>
          </label>
          <label class="filter-label" style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.7rem; cursor: pointer; padding: 0.25rem 0.375rem; background: rgba(49, 46, 129, 0.5); border-radius: 0.375rem; border: 1px solid #818cf8; white-space: nowrap;">
            <input type="checkbox" id="filterSoundbar" checked onchange="applyFilters()" onclick="handleFilterClick(event, 'filterSoundbar')" style="cursor: pointer;">
            <span>üîä Soundbar</span>
            <button class="filter-only-btn" onclick="event.preventDefault(); event.stopPropagation(); selectOnlyFilter('filterSoundbar')" title="Show only this type">only</button>
          </label>
          <label class="filter-label" style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.7rem; cursor: pointer; padding: 0.25rem 0.375rem; background: rgba(66, 32, 6, 0.5); border-radius: 0.375rem; border: 1px solid #fb923c; white-space: nowrap;">
            <input type="checkbox" id="filterAppliance" checked onchange="applyFilters()" onclick="handleFilterClick(event, 'filterAppliance')" style="cursor: pointer;">
            <span>üè† Appliance</span>
            <button class="filter-only-btn" onclick="event.preventDefault(); event.stopPropagation(); selectOnlyFilter('filterAppliance')" title="Show only this type">only</button>
          </label>
          <label class="filter-label" style="display: flex; align-items: center; gap: 0.25rem; font-size: 0.7rem; cursor: pointer; padding: 0.25rem 0.375rem; background: rgba(55, 65, 81, 0.5); border-radius: 0.375rem; border: 1px solid #9ca3af; white-space: nowrap;">
            <input type="checkbox" id="filterOther" checked onchange="applyFilters()" onclick="handleFilterClick(event, 'filterOther')" style="cursor: pointer;">
            <span>‚ùì Other</span>
            <button class="filter-only-btn" onclick="event.preventDefault(); event.stopPropagation(); selectOnlyFilter('filterOther')" title="Show only this type">only</button>
          </label>
        </div>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
      <div class="search-input-wrapper">
        <span class="search-icon">üîç</span>
        <input type="text" id="endpointSearch" class="search-input" placeholder="Search by name, vendor, or model..." oninput="applyFilters(); pauseRefreshTemporarily(5000);">
      </div>
      <div class="refresh-controls">
        <select id="refreshInterval" onchange="updateRefreshInterval(this.value)" style="padding: 0.35rem 0.5rem; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(71, 85, 105, 0.5); border-radius: 0.375rem; color: var(--text-primary); font-size: 0.75rem; cursor: pointer;">
          <option value="0">Auto-Refresh: Off</option>
          <option value="3">3 seconds</option>
          <option value="5" selected>5 seconds</option>
          <option value="10">10 seconds</option>
          <option value="30">30 seconds</option>
          <option value="60">1 minute</option>
        </select>
        <button onclick="manualRefresh()" class="stop-refresh-btn" title="Refresh now">üîÑ</button>
        <button id="refreshToggleBtn" onclick="toggleRefresh()" class="stop-refresh-btn" title="Stop auto-refresh">‚èπÔ∏è</button>
        <div class="pulse"></div>
      </div>
    </div>

    <main id="graph-container">
      <!-- Endpoints Table View -->
      <div class="endpoints-table-container">
        <div class="endpoints-table-wrapper">
        <table class="endpoints-table" id="endpoints-table">
          <thead>
            <tr>
              <th data-sort="type" class="sortable">Type<span class="sort-icon"></span></th>
              <th data-sort="name" class="sortable sorted-asc">Name<span class="sort-icon"></span></th>
              <th data-sort="vendor" class="sortable">Vendor<span class="sort-icon"></span></th>
              <th data-sort="model" class="sortable">Model<span class="sort-icon"></span></th>
              <th data-sort="bandwidth" class="sortable">Bandwidth<span class="sort-icon"></span></th>
              <th data-sort="last_seen" class="sortable">Last Seen<span class="sort-icon"></span></th>
            </tr>
          </thead>
          <tbody>
            {% for node in dropdown_endpoints %}
            {% set node_lower = node | lower %}
            <tr class="endpoint-row {% if node == selected_node %}selected{% endif %}"
                onclick="selectNode('{{ node | safe }}')"
                data-endpoint="{{ node | safe }}"
                data-endpoint-name="{{ node | safe }}"
                data-endpoint-vendor="{{ endpoint_vendors[node_lower] | default(value='') }}"
                data-endpoint-model="{{ endpoint_models[node_lower] | default(value='') }}"
                data-endpoint-type="{% if node == hostname %}local{% elif endpoint_types[node] == "gateway" %}gateway{% elif endpoint_types[node] == "internet" %}internet{% elif endpoint_types[node] == "printer" %}printer{% elif endpoint_types[node] == "tv" %}tv{% elif endpoint_types[node] == "gaming" %}gaming{% elif endpoint_types[node] == "phone" %}phone{% elif endpoint_types[node] == "virtualization" %}virtualization{% elif endpoint_types[node] == "soundbar" %}soundbar{% elif endpoint_types[node] == "appliance" %}appliance{% elif endpoint_types[node] %}local{% else %}other{% endif %}"
                data-endpoint-bytes="{{ endpoint_bytes[node_lower] | default(value=0) }}">
              <td class="endpoint-type-cell">{% if node == hostname %}üñ•Ô∏è{% elif endpoint_types[node] == "gateway" %}üåê{% elif endpoint_types[node] == "internet" %}üåç{% elif endpoint_types[node] == "printer" %}üñ®Ô∏è{% elif endpoint_types[node] == "tv" %}üì∫{% elif endpoint_types[node] == "gaming" %}üéÆ{% elif endpoint_types[node] == "phone" %}üì±{% elif endpoint_types[node] == "virtualization" %}üñ•{% elif endpoint_types[node] == "soundbar" %}üîä{% elif endpoint_types[node] == "appliance" %}üè†{% elif endpoint_types[node] %}üíª{% else %}‚ùì{% endif %}</td>
              <td class="endpoint-name-cell">{{ node | safe }}</td>
              <td class="vendor-cell" title="{{ endpoint_vendors[node_lower] | default(value='Unknown') }}">{{ endpoint_vendors[node_lower] | default(value='-') }}</td>
              <td class="model-cell" title="{{ endpoint_models[node_lower] | default(value='') }}">{{ endpoint_models[node_lower] | default(value='-') }}</td>
              <td class="bandwidth-cell" data-bytes="{{ endpoint_bytes[node_lower] | default(value=0) }}">
                {% if endpoint_bytes[node_lower] and endpoint_bytes[node_lower] > 0 %}
                  <span class="bandwidth-value">{{ endpoint_bytes[node_lower] }}</span>
                {% else %}
                  <span class="no-data">-</span>
                {% endif %}
              </td>
              <td class="last-seen-cell">{{ endpoint_last_seen[node_lower] | default(value='-') }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        </div><!-- End endpoints-table-wrapper -->
        <!-- Endpoints Pagination -->
        <div class="pagination-container" id="endpoints-pagination">
          <div class="pagination-info">
            <span id="endpoints-page-info">Showing 1-25 of {{ dropdown_endpoints | length }}</span>
            <select class="page-size-select" id="endpoints-page-size" onchange="changePageSize('endpoints')">
              <option value="25" selected>25 per page</option>
              <option value="50">50 per page</option>
              <option value="100">100 per page</option>
              <option value="all">Show all</option>
            </select>
          </div>
          <div class="pagination-controls" id="endpoints-page-controls">
            <!-- Page buttons will be generated by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Zoom Controls - Hidden for table view -->
      <div class="zoom-controls" style="display: none;">
        <button class="zoom-btn" onclick="zoomIn()" title="Zoom in">+</button>
        <button class="zoom-btn" onclick="zoomOut()" title="Zoom out">‚àí</button>
        <button class="zoom-btn" onclick="fitGraph()" title="Fit to view">‚ä°</button>
      </div>

      <!-- No Communications Message -->
      <div id="no-communications-msg" style="display: none; position: absolute; top: 50%; left: calc(50% - 160px); transform: translate(-50%, -50%); text-align: center; color: var(--text-secondary); pointer-events: none;">
        <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;">üì°</div>
        <div style="font-size: 1.25rem; font-weight: 500; margin-bottom: 0.5rem;">No Communications Found</div>
        <div style="font-size: 0.875rem; opacity: 0.7;">No network activity detected for this endpoint in the selected time range</div>
      </div>

      <!-- Protocols Overlay -->
      <div class="protocols-overlay">
        <!-- Endpoint Details Header with Tabs -->
        <div class="overlay-header" style="display: flex; justify-content: space-between; align-items: center;">
          <span>Endpoint Details</span>
          <div class="detail-tabs">
            <button class="detail-tab active" data-tab="details-tab-content" onclick="switchDetailTab(this, 'details-tab-content')">Details</button>
            <button class="detail-tab" data-tab="control-tab-content" onclick="switchDetailTab(this, 'control-tab-content')">Control</button>
          </div>
        </div>

        <!-- Details Tab Content -->
        <div id="details-tab-content" class="detail-tab-content active">
        <div style="margin-bottom: 0.75rem;">
          <!-- Endpoint Name with Rename -->
          <div id="endpoint-name-display" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
            <span style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary); word-break: break-all;">{% if endpoint %}{{ endpoint }}{% else %}No endpoint selected{% endif %}</span>
            {% if endpoint %}<button onclick="showRenameInput()" style="background: none; border: none; cursor: pointer; padding: 0.125rem; color: var(--text-secondary); font-size: 0.75rem;" title="Rename endpoint">‚úèÔ∏è</button>{% endif %}
          </div>
          <div id="endpoint-rename-input" style="display: none; margin-bottom: 0.5rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <input type="text" id="custom-name-input" placeholder="Enter custom name" style="flex: 1; padding: 0.375rem 0.5rem; font-size: 0.875rem; border: 1px solid var(--border-color); border-radius: 0.25rem; background: var(--card-bg); color: var(--text-primary);">
              <button onclick="saveCustomName()" style="padding: 0.375rem 0.75rem; font-size: 0.75rem; background: var(--accent-primary); color: white; border: none; border-radius: 0.25rem; cursor: pointer;">Save</button>
              <button onclick="cancelRename()" style="padding: 0.375rem 0.75rem; font-size: 0.75rem; background: var(--card-bg); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 0.25rem; cursor: pointer;">Cancel</button>
              <button onclick="clearCustomName()" style="padding: 0.375rem 0.75rem; font-size: 0.75rem; background: #dc2626; color: white; border: none; border-radius: 0.25rem; cursor: pointer;" title="Reset to original name">Reset</button>
            </div>
          </div>
          <!-- Device Type Dropdown -->
          <div style="margin-bottom: 0.75rem;">
            <div class="device-type-selector" {% if not endpoint %}style="display: none;"{% endif %}>
              <button class="device-type-btn {% if endpoint in manual_overrides %}manual-override{% endif %}" onclick="toggleDeviceTypeDropdown(event)" id="device-type-btn">
                <span>Type:</span>
                <span id="current-device-type">
                  {% if endpoint_types[endpoint] == "gateway" %}üåê Gateway
                  {% elif endpoint_types[endpoint] == "internet" %}üåç Internet
                  {% elif endpoint_types[endpoint] == "printer" %}üñ®Ô∏è Printer
                  {% elif endpoint_types[endpoint] == "tv" %}üì∫ TV
                  {% elif endpoint_types[endpoint] == "gaming" %}üéÆ Gaming
                  {% elif endpoint_types[endpoint] == "phone" %}üì± Phone
                  {% elif endpoint_types[endpoint] == "virtualization" %}üñ• VM
                  {% elif endpoint_types[endpoint] == "soundbar" %}üîä Soundbar
                  {% elif endpoint_types[endpoint] == "appliance" %}üè† Appliance
                  {% elif endpoint_types[endpoint] == "local" %}üñ•Ô∏è Local
                  {% elif endpoint_types[endpoint] %}üíª {{ endpoint_types[endpoint] }}
                  {% else %}‚ùì Other
                  {% endif %}
                </span>
                <span class="dropdown-arrow">‚ñº</span>
              </button>
              <div class="device-type-dropdown" id="device-type-dropdown">
                <div class="device-type-option auto-option" onclick="reclassifyEndpoint('auto')">üîÑ Auto (detect automatically)</div>
                <div class="device-type-option {% if endpoint_types[endpoint] == 'local' %}selected{% endif %}" onclick="reclassifyEndpoint('local')">üñ•Ô∏è Local</div>
                <div class="device-type-option {% if endpoint_types[endpoint] == 'printer' %}selected{% endif %}" onclick="reclassifyEndpoint('printer')">üñ®Ô∏è Printer</div>
                <div class="device-type-option {% if endpoint_types[endpoint] == 'tv' %}selected{% endif %}" onclick="reclassifyEndpoint('tv')">üì∫ TV</div>
                <div class="device-type-option {% if endpoint_types[endpoint] == 'gaming' %}selected{% endif %}" onclick="reclassifyEndpoint('gaming')">üéÆ Gaming</div>
                <div class="device-type-option {% if endpoint_types[endpoint] == 'phone' %}selected{% endif %}" onclick="reclassifyEndpoint('phone')">üì± Phone</div>
                <div class="device-type-option {% if endpoint_types[endpoint] == 'virtualization' %}selected{% endif %}" onclick="reclassifyEndpoint('virtualization')">üñ• VM</div>
                <div class="device-type-option {% if endpoint_types[endpoint] == 'soundbar' %}selected{% endif %}" onclick="reclassifyEndpoint('soundbar')">üîä Soundbar</div>
                <div class="device-type-option {% if endpoint_types[endpoint] == 'appliance' %}selected{% endif %}" onclick="reclassifyEndpoint('appliance')">üè† Appliance</div>
                <div class="device-type-option {% if endpoint_types[endpoint] == 'other' %}selected{% endif %}" onclick="reclassifyEndpoint('other')">‚ùì Other</div>
              </div>
            </div>
            <span id="manual-override-indicator" style="font-size: 0.625rem; color: var(--accent-secondary); margin-left: 0.5rem; {% if not endpoint in manual_overrides %}display: none;{% endif %}">(manually set)</span>
            <span id="device-vendor-badge" style="font-size: 0.875rem; font-weight: bold; color: #60a5fa; background: rgba(59, 130, 246, 0.15); padding: 0.25rem 0.5rem; border-radius: 0.25rem; margin-left: 0.5rem; {% if not device_vendor %}display: none;{% endif %}">{{ device_vendor }}</span>
            <span id="device-model-badge" style="font-size: 0.875rem; font-weight: bold; color: #a78bfa; background: rgba(139, 92, 246, 0.15); padding: 0.25rem 0.5rem; border-radius: 0.25rem; margin-left: 0.5rem; {% if not device_model %}display: none;{% endif %}">{{ device_model }}</span>
          </div>
          <div class="stats">
            <div class="stat-badge stat-link" onclick="scrollToSection('ips-section')">IPs: <span class="stat-number">{{ ips|length }}</span></div>
            <div class="stat-badge stat-link" onclick="scrollToSection('macs-section')">MACs: <span class="stat-number">{{ macs|length }}</span></div>
            <div class="stat-badge stat-link" onclick="scrollToSection('hostnames-section')">Hosts: <span class="stat-number">{{ hostnames|length }}</span></div>
            <div class="stat-badge stat-link" onclick="scrollToSection('ports-section')">Ports: <span class="stat-number">{{ ports|length }}</span></div>
            <div class="stat-badge stat-link" onclick="scrollToSection('protocols-section')">Protocols: <span class="stat-number">{{ protocols|length }}</span></div>
          </div>
          <div class="stats" style="margin-top: 0.5rem;">
            <div class="stat-badge">‚¨áÔ∏è In: <span class="stat-number" id="bytes-in">{{ bytes_in }}</span></div>
            <div class="stat-badge">‚¨ÜÔ∏è Out: <span class="stat-number" id="bytes-out">{{ bytes_out }}</span></div>
          </div>
        </div>

        <div class="overlay-header" id="protocols-section">
          Protocols
        </div>
        <div class="overlay-content" id="protocols-container">
          {% if not endpoint %}
            <div class="empty-state">No endpoint selected</div>
          {% elif protocols %}
            {% for protocol in protocols %}
            <div class="protocol-badge" data-protocol="{{ protocol | safe }}" onclick="filterByProtocol('{{ protocol | safe }}', this)">{{ protocol | safe }}</div>
            {% endfor %}
          {% else %}
            <div class="empty-state">No protocols</div>
          {% endif %}
        </div>

        <!-- Ports -->
        <div class="overlay-header" id="ports-section">
          Ports
          <button class="clear-port-filter-btn" onclick="clearPortFilter()" style="display: none;">Clear</button>
        </div>
        <div style="margin-bottom: 0.75rem;">
          <input type="text" id="portsListSearch" placeholder="Filter ports..."
                 oninput="filterPortsList(this.value)"
                 style="width: 100%; background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(51, 65, 85, 0.6); color: var(--text-primary); padding: 0.5rem 0.75rem; border-radius: 0.5rem; font-size: 0.75rem;">
        </div>
        <div class="listbox" id="ports-container">
          {% if not endpoint %}
            <div class="empty-state">No endpoint selected</div>
          {% elif ports %}
            {% for port in ports %}
            <div class="listbox-item" data-port="{{ port | safe }}" onclick="filterByPort('{{ port | safe }}', this)">{{ port | safe }}</div>
            {% endfor %}
          {% else %}
            <div class="empty-state">No ports</div>
          {% endif %}
        </div>

        <div class="overlay-header" id="hostnames-section">
          Hostnames
        </div>
        <div style="margin-bottom: 0.75rem;">
          <input type="text" id="hostnamesListSearch" placeholder="Filter hostnames..."
                 oninput="filterHostnamesList(this.value)"
                 style="width: 100%; background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(51, 65, 85, 0.6); color: var(--text-primary); padding: 0.5rem 0.75rem; border-radius: 0.5rem; font-size: 0.75rem;">
        </div>
        <div class="listbox" id="hostnames-container">
          {% if not endpoint %}
            <div class="empty-state">No endpoint selected</div>
          {% elif hostnames %}
            {% for hostname in hostnames %}
            <div class="listbox-item">{{ hostname | safe }}</div>
            {% endfor %}
          {% else %}
            <div class="empty-state">No hostnames</div>
          {% endif %}
        </div>

        <!-- IP Addresses -->
        <div class="overlay-header" id="ips-section">
          IP Addresses
        </div>
        <div style="margin-bottom: 0.75rem;">
          <input type="text" id="ipsListSearch" placeholder="Filter IPs..."
                 oninput="filterIpsList(this.value)"
                 style="width: 100%; background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(51, 65, 85, 0.6); color: var(--text-primary); padding: 0.5rem 0.75rem; border-radius: 0.5rem; font-size: 0.75rem;">
        </div>
        <div class="overlay-hostnames" id="ips-container">
          {% if not endpoint %}
            <div class="empty-state">No endpoint selected</div>
          {% elif ips %}
            {% for ip in ips %}
            <div class="hostname-item">{{ ip | safe }}</div>
            {% endfor %}
          {% else %}
            <div class="empty-state">No IP addresses</div>
          {% endif %}
        </div>

        <!-- MAC Addresses -->
        <div class="overlay-header" id="macs-section">
          MAC Addresses
        </div>
        <div style="margin-bottom: 0.75rem;">
          <input type="text" id="macsListSearch" placeholder="Filter MACs..."
                 oninput="filterMacsList(this.value)"
                 style="width: 100%; background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(51, 65, 85, 0.6); color: var(--text-primary); padding: 0.5rem 0.75rem; border-radius: 0.5rem; font-size: 0.75rem;">
        </div>
        <div class="overlay-hostnames" id="macs-container">
          {% if not endpoint %}
            <div class="empty-state">No endpoint selected</div>
          {% elif macs %}
            {% for mac in macs %}
            <div class="hostname-item">{{ mac | safe }}</div>
            {% endfor %}
          {% else %}
            <div class="empty-state">No MAC addresses</div>
          {% endif %}
        </div>

        <!-- Delete Endpoint Button -->
        {% if endpoint %}
        <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(71, 85, 105, 0.3);">
          <button onclick="deleteEndpoint('{{ endpoint }}')"
                  style="width: 100%; padding: 0.75rem; background: #dc2626; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: background-color 0.2s;"
                  onmouseover="this.style.backgroundColor='#b91c1c'"
                  onmouseout="this.style.backgroundColor='#dc2626'">
            üóëÔ∏è Delete Endpoint
          </button>
          <div style="font-size: 0.7rem; color: var(--text-secondary); text-align: center; margin-top: 0.5rem;">
            Removes endpoint and all associated communications
          </div>
        </div>
        {% endif %}
        </div><!-- End Details Tab Content -->

        <!-- Control Tab Content -->
        <div id="control-tab-content" class="detail-tab-content">
          <div id="device-control-container">
            <div class="control-loading" id="control-loading">
              <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                Loading device capabilities...
              </div>
            </div>
            <div id="control-content" style="display: none;">
              <!-- Device info -->
              <div id="device-info-section" style="margin-bottom: 1rem; display: none;">
                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Device</div>
                <div id="device-model" style="font-weight: 600;"></div>
              </div>

              <!-- No control available message -->
              <div id="no-control-message" style="display: none; text-align: center; padding: 2rem; color: var(--text-secondary);">
                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üîí</div>
                <div>No remote control available for this device type.</div>
                <div style="font-size: 0.75rem; margin-top: 0.5rem;">Currently supports: Roku and Samsung TVs</div>
              </div>

              <!-- Pairing Required Message (for TVs) -->
              <div id="pairing-required" style="display: none; text-align: center; padding: 1.5rem;">
                <div style="font-size: 2rem; margin-bottom: 0.75rem;">üì∫</div>
                <div style="font-weight: 600; margin-bottom: 0.5rem;">Pairing Required</div>
                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 1rem;">
                  Click the button below, then approve the connection on your TV screen.
                </div>
                <button class="remote-btn" onclick="pairDevice()" style="width: 100%; padding: 0.75rem; font-size: 0.9rem; background: var(--accent-secondary);">
                  üîó Pair with TV
                </button>
                <div id="pairing-status" style="margin-top: 0.75rem; font-size: 0.75rem; color: var(--text-secondary);"></div>
              </div>

              <!-- ThinQ Setup Required Message -->
              <div id="thinq-setup-required" style="display: none; padding: 1.5rem;">
                <div style="text-align: center; margin-bottom: 1rem;">
                  <div style="font-size: 2rem; margin-bottom: 0.75rem;">üè†</div>
                  <div style="font-weight: 600; margin-bottom: 0.5rem;">LG ThinQ Setup Required</div>
                  <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 1rem;">
                    Enter your Personal Access Token from the <a href="https://smartsolution.developer.lge.com/en/apiManage/thinq_connect" target="_blank" style="color: var(--accent-primary);">LG ThinQ Developer Site</a>
                  </div>
                </div>
                <div style="margin-bottom: 1rem;">
                  <label style="display: block; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Personal Access Token (PAT)</label>
                  <input type="password" id="thinq-pat-token" placeholder="Paste your PAT token here" style="width: 100%; padding: 0.5rem; background: rgba(30, 41, 59, 0.8); border: 1px solid #4b5563; border-radius: 0.375rem; color: var(--text-primary); font-size: 0.875rem;">
                </div>
                <div style="margin-bottom: 1rem;">
                  <label style="display: block; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Country Code</label>
                  <select id="thinq-country-code" style="width: 100%; padding: 0.5rem; background: rgba(30, 41, 59, 0.8); border: 1px solid #4b5563; border-radius: 0.375rem; color: var(--text-primary); font-size: 0.875rem;">
                    <option value="US">United States (US)</option>
                    <option value="CA">Canada (CA)</option>
                    <option value="MX">Mexico (MX)</option>
                    <option value="GB">United Kingdom (GB)</option>
                    <option value="DE">Germany (DE)</option>
                    <option value="FR">France (FR)</option>
                    <option value="IT">Italy (IT)</option>
                    <option value="ES">Spain (ES)</option>
                    <option value="KR">South Korea (KR)</option>
                    <option value="JP">Japan (JP)</option>
                    <option value="AU">Australia (AU)</option>
                    <option value="NZ">New Zealand (NZ)</option>
                  </select>
                </div>
                <button class="remote-btn" onclick="setupThinQ()" style="width: 100%; padding: 0.75rem; font-size: 0.9rem; background: var(--accent-secondary);">
                  üîó Connect to LG ThinQ
                </button>
                <div id="thinq-setup-status" style="margin-top: 0.75rem; font-size: 0.75rem; color: var(--text-secondary);"></div>
              </div>

              <!-- Roku Remote Control -->
              <div id="roku-remote" style="display: none;">
                <!-- Navigation Pad -->
                <div class="remote-section">
                  <div class="remote-label">Navigation</div>
                  <div class="remote-dpad">
                    <button class="remote-btn dpad-up" onclick="sendCommand('Up')" title="Up">‚ñ≤</button>
                    <button class="remote-btn dpad-left" onclick="sendCommand('Left')" title="Left">‚óÄ</button>
                    <button class="remote-btn dpad-ok" onclick="sendCommand('Select')" title="OK">OK</button>
                    <button class="remote-btn dpad-right" onclick="sendCommand('Right')" title="Right">‚ñ∂</button>
                    <button class="remote-btn dpad-down" onclick="sendCommand('Down')" title="Down">‚ñº</button>
                  </div>
                  <div class="remote-row" style="margin-top: 0.5rem;">
                    <button class="remote-btn" onclick="sendCommand('Back')" title="Back">‚Ü©Ô∏è Back</button>
                    <button class="remote-btn" onclick="sendCommand('Home')" title="Home">üè† Home</button>
                  </div>
                </div>

                <!-- Playback Controls -->
                <div class="remote-section">
                  <div class="remote-label">Playback</div>
                  <div class="remote-row">
                    <button class="remote-btn" onclick="sendCommand('Rev')" title="Rewind">‚è™</button>
                    <button class="remote-btn" onclick="sendCommand('Play')" title="Play/Pause">‚èØÔ∏è</button>
                    <button class="remote-btn" onclick="sendCommand('Fwd')" title="Fast Forward">‚è©</button>
                  </div>
                </div>

                <!-- Volume Controls -->
                <div class="remote-section">
                  <div class="remote-label">Volume</div>
                  <div class="remote-row">
                    <button class="remote-btn" onclick="sendCommand('VolumeDown')" title="Volume Down">üîâ</button>
                    <button class="remote-btn" onclick="sendCommand('VolumeMute')" title="Mute">üîá</button>
                    <button class="remote-btn" onclick="sendCommand('VolumeUp')" title="Volume Up">üîä</button>
                  </div>
                </div>

                <!-- Power -->
                <div class="remote-section">
                  <div class="remote-row">
                    <button class="remote-btn power-btn" onclick="sendCommand('PowerOff')" title="Power Off">‚èª Power Off</button>
                  </div>
                </div>

                <!-- Apps -->
                <div id="apps-section" style="display: none;">
                  <div class="remote-label">Apps</div>
                  <div id="apps-grid" class="apps-grid">
                    <!-- Apps will be loaded dynamically -->
                  </div>
                </div>
              </div>

              <!-- Samsung Remote Control -->
              <div id="samsung-remote" style="display: none;">
                <!-- Navigation Pad -->
                <div class="remote-section">
                  <div class="remote-label">Navigation</div>
                  <div class="remote-dpad">
                    <button class="remote-btn dpad-up" onclick="sendCommand('KEY_UP')" title="Up">‚ñ≤</button>
                    <button class="remote-btn dpad-left" onclick="sendCommand('KEY_LEFT')" title="Left">‚óÄ</button>
                    <button class="remote-btn dpad-ok" onclick="sendCommand('KEY_ENTER')" title="OK">OK</button>
                    <button class="remote-btn dpad-right" onclick="sendCommand('KEY_RIGHT')" title="Right">‚ñ∂</button>
                    <button class="remote-btn dpad-down" onclick="sendCommand('KEY_DOWN')" title="Down">‚ñº</button>
                  </div>
                  <div class="remote-row" style="margin-top: 0.5rem;">
                    <button class="remote-btn" onclick="sendCommand('KEY_RETURN')" title="Back">‚Ü©Ô∏è Back</button>
                    <button class="remote-btn" onclick="sendCommand('KEY_HOME')" title="Home">üè† Home</button>
                    <button class="remote-btn" onclick="sendCommand('KEY_EXIT')" title="Exit">‚úï Exit</button>
                  </div>
                </div>

                <!-- Playback Controls -->
                <div class="remote-section">
                  <div class="remote-label">Playback</div>
                  <div class="remote-row">
                    <button class="remote-btn" onclick="sendCommand('KEY_REWIND')" title="Rewind">‚è™</button>
                    <button class="remote-btn" onclick="sendCommand('KEY_PLAY')" title="Play">‚ñ∂Ô∏è</button>
                    <button class="remote-btn" onclick="sendCommand('KEY_PAUSE')" title="Pause">‚è∏Ô∏è</button>
                    <button class="remote-btn" onclick="sendCommand('KEY_FF')" title="Fast Forward">‚è©</button>
                  </div>
                </div>

                <!-- Volume & Channel Controls -->
                <div class="remote-section">
                  <div class="remote-label">Volume / Channel</div>
                  <div class="remote-row">
                    <button class="remote-btn" onclick="sendCommand('KEY_VOLDOWN')" title="Volume Down">üîâ</button>
                    <button class="remote-btn" onclick="sendCommand('KEY_MUTE')" title="Mute">üîá</button>
                    <button class="remote-btn" onclick="sendCommand('KEY_VOLUP')" title="Volume Up">üîä</button>
                  </div>
                  <div class="remote-row" style="margin-top: 0.5rem;">
                    <button class="remote-btn" onclick="sendCommand('KEY_CHDOWN')" title="Channel Down">üì∫-</button>
                    <button class="remote-btn" onclick="sendCommand('KEY_CHUP')" title="Channel Up">üì∫+</button>
                  </div>
                </div>

                <!-- Power & Input -->
                <div class="remote-section">
                  <div class="remote-row">
                    <button class="remote-btn" onclick="sendCommand('KEY_SOURCE')" title="Source">üîå Source</button>
                    <button class="remote-btn" onclick="sendCommand('KEY_MENU')" title="Menu">‚ò∞ Menu</button>
                  </div>
                  <div class="remote-row" style="margin-top: 0.5rem;">
                    <button class="remote-btn power-btn" onclick="sendCommand('KEY_POWER')" title="Power">‚èª Power</button>
                  </div>
                </div>
              </div>

              <!-- LG ThinQ Remote Control -->
              <div id="thinq-remote" style="display: none;">
                <!-- Device Status Section -->
                <div class="remote-section">
                  <div class="remote-label">Device Status</div>
                  <div id="thinq-device-status" style="font-size: 0.8rem; color: var(--text-secondary); padding: 0.5rem; background: rgba(30, 41, 59, 0.5); border-radius: 0.375rem; margin-bottom: 0.5rem;">
                    Loading status...
                  </div>
                  <button class="remote-btn" onclick="refreshThinQStatus()" style="width: 100%;">üîÑ Refresh Status</button>
                </div>

                <!-- Appliance Controls -->
                <div class="remote-section">
                  <div class="remote-label">Controls</div>
                  <div id="thinq-controls" class="remote-row" style="flex-wrap: wrap; gap: 0.5rem;">
                    <!-- Controls will be populated based on device type -->
                  </div>
                </div>

                <!-- Disconnect -->
                <div class="remote-section">
                  <button class="remote-btn" onclick="disconnectThinQ()" style="width: 100%; background: rgba(239, 68, 68, 0.2); border-color: rgba(239, 68, 68, 0.5);">
                    üîå Disconnect ThinQ
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div><!-- End Control Tab Content -->
      </div>
    </main>
  </div>
  </div><!-- End Network Tab -->

  <!-- DNS Tab Content -->
  <div id="dns-tab" class="tab-content">
    <div class="dns-table-container">
      <h2 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.25rem;">mDNS Discovery Entries</h2>
      <table class="dns-table" id="mdns-table">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>IP Address</th>
            <th>Hostname</th>
            <th>Services</th>
          </tr>
        </thead>
        <tbody>
          {% for entry in dns_entries %}
          <tr>
            <td>{{ entry.timestamp }}</td>
            <td>{{ entry.ip }}</td>
            <td>{{ entry.hostname }}</td>
            <td>{{ entry.services }}</td>
          </tr>
          {% endfor %}
          {% if dns_entries | length == 0 %}
          <tr class="empty-row">
            <td colspan="4" style="text-align: center; color: var(--text-secondary); padding: 2rem;">No mDNS entries discovered yet</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
      <!-- mDNS Pagination -->
      <div class="pagination-container" id="mdns-pagination">
        <div class="pagination-info">
          <span id="mdns-page-info">Showing 1-50 of {{ dns_entries | length }}</span>
          <select class="page-size-select" id="mdns-page-size" onchange="changePageSize('mdns')">
            <option value="50" selected>50 per page</option>
            <option value="100">100 per page</option>
            <option value="250">250 per page</option>
            <option value="all">Show all</option>
          </select>
        </div>
        <div class="pagination-controls" id="mdns-page-controls">
          <!-- Page buttons will be generated by JavaScript -->
        </div>
      </div>
    </div>
  </div><!-- End DNS Tab -->

  <!-- Scanner Tab Content -->
  <div id="scanner-tab" class="tab-content">
    <div class="dns-table-container" style="display: flex; flex-direction: column; align-items: center; padding-top: 2rem;">
      <div style="max-width: 600px; width: 100%;">
        <h2 style="color: var(--text-primary); margin-bottom: 1.5rem; font-size: 1.25rem; text-align: center;">Network Scanner</h2>

        <div class="card" style="padding: 1.5rem;">
          <div class="card-title" style="margin-bottom: 1rem; font-size: 0.875rem;">Scan Types</div>

          <!-- Scan Type Checkboxes -->
          <div style="display: flex; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 1.5rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; cursor: pointer; padding: 0.5rem 0.75rem; background: rgba(55, 65, 81, 0.5); border-radius: 0.5rem; border: 1px solid #4b5563; flex: 1; min-width: 120px;">
              <input type="checkbox" id="scan-arp" checked style="cursor: pointer; width: 1rem; height: 1rem;">
              <div>
                <div style="font-weight: 500;">ARP</div>
                <div style="font-size: 0.7rem; color: var(--text-secondary);">Find devices by MAC</div>
              </div>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; cursor: pointer; padding: 0.5rem 0.75rem; background: rgba(55, 65, 81, 0.5); border-radius: 0.5rem; border: 1px solid #4b5563; flex: 1; min-width: 120px;">
              <input type="checkbox" id="scan-icmp" checked style="cursor: pointer; width: 1rem; height: 1rem;">
              <div>
                <div style="font-weight: 500;">Ping</div>
                <div style="font-size: 0.7rem; color: var(--text-secondary);">ICMP echo sweep</div>
              </div>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; cursor: pointer; padding: 0.5rem 0.75rem; background: rgba(55, 65, 81, 0.5); border-radius: 0.5rem; border: 1px solid #4b5563; flex: 1; min-width: 120px;">
              <input type="checkbox" id="scan-port" style="cursor: pointer; width: 1rem; height: 1rem;">
              <div>
                <div style="font-weight: 500;">Ports</div>
                <div style="font-size: 0.7rem; color: var(--text-secondary);">TCP port probe</div>
              </div>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; cursor: pointer; padding: 0.5rem 0.75rem; background: rgba(55, 65, 81, 0.5); border-radius: 0.5rem; border: 1px solid #4b5563; flex: 1; min-width: 120px;">
              <input type="checkbox" id="scan-ssdp" checked style="cursor: pointer; width: 1rem; height: 1rem;">
              <div>
                <div style="font-weight: 500;">SSDP</div>
                <div style="font-size: 0.7rem; color: var(--text-secondary);">UPnP discovery</div>
              </div>
            </label>
          </div>

          <!-- Privilege Warning -->
          <div id="privilege-warning" style="display: none; margin-bottom: 1rem; padding: 0.75rem; background: rgba(245, 158, 11, 0.15); border: 1px solid rgba(245, 158, 11, 0.4); border-radius: 0.5rem; font-size: 0.75rem; color: #fbbf24;">
            ‚ö†Ô∏è ARP and Ping scans require root/admin privileges. Run with <code style="background: rgba(0,0,0,0.3); padding: 0.125rem 0.25rem; border-radius: 0.25rem;">sudo</code> to enable.
          </div>

          <!-- Scan Buttons -->
          <div id="scan-buttons" style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
            <button id="start-scan-btn" onclick="startNetworkScan()" style="flex: 1; padding: 0.75rem; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.4); color: #60a5fa; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; font-weight: 600; transition: all 0.2s;">
              üîç Scan Network
            </button>
            <button id="stop-scan-btn" onclick="stopNetworkScan()" style="display: none; flex: 1; padding: 0.75rem; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.4); color: #f87171; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; font-weight: 600; transition: all 0.2s;">
              ‚èπ Stop Scan
            </button>
          </div>

          <!-- Progress -->
          <div id="scan-progress" style="display: none; margin-bottom: 1rem;">
            <div style="background: rgba(51, 65, 85, 0.6); border-radius: 0.375rem; height: 8px; overflow: hidden;">
              <div id="scan-progress-fill" style="background: linear-gradient(90deg, #3b82f6, #8b5cf6); height: 100%; width: 0%; transition: width 0.3s;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;">
              <span id="scan-phase">Scanning...</span>
              <span id="scan-progress-text">0%</span>
            </div>
          </div>

          <!-- Stats -->
          <div style="display: flex; gap: 1rem; justify-content: center;">
            <div class="stat-badge" style="font-size: 0.75rem; padding: 0.5rem 1rem;">
              <span style="color: var(--text-secondary);">Last Scan:</span>
              <span id="last-scan-time" style="font-weight: 500;">Never</span>
            </div>
            <div class="stat-badge" style="font-size: 0.75rem; padding: 0.5rem 1rem;">
              <span style="color: var(--text-secondary);">Devices Found:</span>
              <span id="discovered-count" class="stat-number" style="font-weight: 500;">0</span>
            </div>
          </div>
        </div>

        <!-- Scan Results Table -->
        <div class="card" style="margin-top: 1rem; padding: 1rem;">
          <div class="card-title" style="margin-bottom: 0.75rem; font-size: 0.875rem;">Recent Scan Results</div>
          <div id="scan-results-container" style="max-height: 300px; overflow-y: auto;">
            <table class="dns-table" style="font-size: 0.75rem;">
              <thead>
                <tr>
                  <th>IP Address</th>
                  <th>MAC Address</th>
                  <th>Method</th>
                  <th>Details</th>
                </tr>
              </thead>
              <tbody id="scan-results-body">
                <tr>
                  <td colspan="4" style="text-align: center; color: var(--text-secondary); padding: 1rem;">No scan results yet. Click "Scan Network" to discover devices.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div><!-- End Scanner Tab -->

  <!-- PCAP Tab -->
  <div id="pcap-tab" class="tab-content">
    <div class="dns-table-container" style="display: flex; flex-direction: column; align-items: center; padding-top: 2rem;">
      <div style="max-width: 600px; width: 100%;">
        <h2 style="color: var(--text-primary); margin-bottom: 1.5rem; font-size: 1.25rem; text-align: center;">PCAP File Upload</h2>
        <p style="text-align: center; color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1.5rem;">
          Upload packet capture files (.pcap, .pcapng, .cap) to analyze network communications.
        </p>

        <div class="card" style="padding: 1.5rem;">
          <form id="pcap-upload-form" style="display: flex; flex-direction: column; gap: 1rem;">
            <!-- File Input -->
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <label style="font-size: 0.75rem; color: var(--text-secondary); font-weight: 500;">Select PCAP File</label>
              <input type="file" id="pcap-file" accept=".pcap,.pcapng,.cap" required
                style="padding: 0.75rem; background: rgba(55, 65, 81, 0.5); border: 1px solid #4b5563; border-radius: 0.5rem; color: var(--text-primary); font-size: 0.875rem; cursor: pointer;">
            </div>

            <!-- Label Input -->
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <label style="font-size: 0.75rem; color: var(--text-secondary); font-weight: 500;">Label (optional)</label>
              <input type="text" id="pcap-label" placeholder="e.g., office-capture-jan-2024"
                style="padding: 0.75rem; background: rgba(55, 65, 81, 0.5); border: 1px solid #4b5563; border-radius: 0.5rem; color: var(--text-primary); font-size: 0.875rem;">
            </div>

            <!-- Submit Button -->
            <button type="submit" id="pcap-submit-btn"
              style="padding: 0.75rem; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.4); color: #60a5fa; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; font-weight: 600; transition: all 0.2s;">
              Upload & Process
            </button>
          </form>

          <!-- Progress -->
          <div id="pcap-progress" style="display: none; margin-top: 1rem;">
            <div style="background: rgba(51, 65, 85, 0.6); border-radius: 0.375rem; height: 8px; overflow: hidden;">
              <div id="pcap-progress-fill" style="background: linear-gradient(90deg, #3b82f6, #8b5cf6); height: 100%; width: 0%; transition: width 0.3s;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;">
              <span id="pcap-status">Uploading...</span>
              <span id="pcap-progress-text"></span>
            </div>
          </div>

          <!-- Result Message -->
          <div id="pcap-result" style="display: none; margin-top: 1rem; padding: 0.75rem; border-radius: 0.5rem; font-size: 0.875rem;"></div>
        </div>

        <!-- Upload History -->
        <div class="card" style="margin-top: 1rem; padding: 1rem;">
          <div class="card-title" style="margin-bottom: 0.75rem; font-size: 0.875rem;">Recent Uploads</div>
          <div id="pcap-history-container" style="max-height: 200px; overflow-y: auto;">
            <table class="dns-table" style="font-size: 0.75rem;">
              <thead>
                <tr>
                  <th>Filename</th>
                  <th>Label</th>
                  <th>Packets</th>
                  <th>Time</th>
                </tr>
              </thead>
              <tbody id="pcap-history-body">
                <tr>
                  <td colspan="4" style="text-align: center; color: var(--text-secondary); padding: 1rem;">No uploads yet. Upload a PCAP file to get started.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div><!-- End PCAP Tab -->

  <!-- External JavaScript modules -->
  <script src="/static/js/utils.js"></script>
  <script src="/static/js/formatting.js"></script>
  <script src="/static/js/pagination.js"></script>
  <script src="/static/js/tabs.js"></script>
  <script src="/static/js/scanner.js"></script>
  <script src="/static/js/pcap.js"></script>
  <script src="/static/js/endpoints.js"></script>
  <script src="/static/js/filters.js"></script>
  <script src="/static/js/classification.js"></script>
  <script src="/static/js/refresh.js"></script>
  <script src="/static/js/device-control.js"></script>
  <script src="/static/js/lg-thinq.js"></script>
  <script src="/static/js/app.js"></script>

  <!-- Inline script for template data initialization -->
  <script>
    // Set endpoint name for classification (template-dependent)
    {% if endpoint %}
    App.Classification.setEndpointName('{{ endpoint | safe }}');
    {% endif %}

    // Set data attributes for device control (template-dependent)
    document.addEventListener('DOMContentLoaded', function() {
      var controlContent = document.getElementById('control-content');
      if (controlContent) {
        controlContent.dataset.ips = '{{ ips | join(sep=",") }}';
        controlContent.dataset.deviceType = '{{ endpoint_types[endpoint] | default(value="") }}';
        controlContent.dataset.endpointName = '{{ endpoint | default(value="") }}';
      }
    });

    // Initialize the app
    App.init({ endpointName: '{{ endpoint | default(value="") }}' });
  </script>

  <!-- Protocol Endpoints Dropdown -->
  <div id="protocol-dropdown" class="protocol-dropdown">
    <div class="protocol-dropdown-header">Talked via <span id="protocol-dropdown-name"></span></div>
    <div id="protocol-dropdown-content"></div>
  </div>
</body>
</html>
